{% extends "tours/base.html" %}

{% block title %}Рабочий стол{% endblock %}

{% block content %}
<h1 class="mb-4">Рабочий стол</h1>

<div class="alert alert-info">
    Добро пожаловать,
    <strong>
        {% if user.get_full_name %}
            {{ user.get_full_name }}
        {% else %}
            {{ user.username }}
        {% endif %}
    </strong>!
    {% if profile %}
        <br>
        <small class="text-muted">Должность: {{ profile.position }}</small>
    {% endif %}
</div>

<div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Последние договоры</h5>
        <div> <!-- Оборачиваем кнопки в div для лучшего выравнивания -->
            <a href="{% url 'export_contracts_json' %}" class="btn btn-warning btn-sm">Скачать в JSON</a>
            <a href="{% url 'export_contracts_csv' %}" class="btn btn-info btn-sm">Скачать в CSV</a>
            <a href="{% url 'add_contract' %}" class="btn btn-success btn-sm ms-2">Оформить новый договор</a>
        </div>
    </div>
    <div class="card-body">
        <table class="table table-striped table-hover">
            <thead>
                <tr><th>ID</th><th>Клиент</th><th>Тур</th><th>Статус</th></tr>
            </thead>
            <tbody>
                {% for contract in contracts %}
                <tr>
                    <td>{{ contract.id }}</td>
                    <td>{{ contract.client }}</td>
                    <td>{{ contract.tour.title }}</td>
                    <td><span class="badge bg-primary">{{ contract.get_status_display }}</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Новые клиенты</h5>
        <div>
            <a href="{% url 'export_clients_json' %}" class="btn btn-warning btn-sm">Скачать в JSON</a>
            <a href="{% url 'export_clients_csv' %}" class="btn btn-info btn-sm">Скачать в CSV</a>

            <a href="{% url 'add_client' %}" class="btn btn-success btn-sm ms-2">Добавить клиента</a>
        </div>
    </div>
    <div class="card-body">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Имя</th>
                    <th>Email</th>
                    <th>Телефон</th>
                    <th>Документы</th>
                </tr>
            </thead>
            <tbody>
                {% for client in clients %}
                <tr>
                    <td>{{ client }}</td>
                    <td>{{ client.email }}</td>
                    <td>{{ client.phone_number }}</td>
                    <td>
                        {% for doc in client.documents.all %}
                            <small>{{ doc.get_doc_type_display }} №{{ doc.number }}</small><br>
                        {% empty %}
                            <small class="text-muted">Нет данных</small>
                        {% endfor %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<div class="card mt-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Управление турами</h5>
        <a href="{% url 'add_tour' %}" class="btn btn-success btn-sm">Добавить новый тур</a>
    </div>
    <div class="card-body">
        <p>Здесь вы можете добавлять новые туры в систему. Все добавленные туры сразу появятся на главной странице сайта.</p>
        <a href="{% url 'tour_list' %}" class="btn btn-outline-primary btn-sm">Посмотреть витрину туров</a>
    </div>
</div>

{% endblock %}